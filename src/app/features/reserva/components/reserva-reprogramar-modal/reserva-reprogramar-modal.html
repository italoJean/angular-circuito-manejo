<h2 mat-dialog-title class="repro-modal__title">
  <mat-icon class="repro-modal__title-icon">update</mat-icon>
  <span>Reprogramar Reserva #{{ reservaId }}</span>
</h2>

<mat-dialog-content class="repro-modal__content" [formGroup]="form">
  @if (!isLoading) {
  <div class="repro-modal__loading">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Cargando datos de la reserva...</p>
  </div>
  } @else if (reservaOriginal) {
  <div class="repro-modal__info-card">
    <div class="info-item">
      <mat-icon>event_note</mat-icon>
      <div>
        <span class="info-item__label">Fecha Actual</span>
        <span class="info-item__value">{{
          reservaOriginal.fechaReserva | date : 'dd/MM/yyyy HH:mm'
        }}</span>
      </div>
    </div>
    <div class="info-item">
      <mat-icon>directions_car</mat-icon>
      <div>
        <span class="info-item__label">Vehículo</span>
        <span class="info-item__value"
          >{{ reservaOriginal.vehiculo.placa }} ({{ reservaOriginal.vehiculo.modelo }})</span
        >
      </div>
    </div>
    <div class="info-item">
      <mat-icon>person</mat-icon>
      <div>
        <span class="info-item__label">Cliente</span>
        <span class="info-item__value"
          >{{ reservaOriginal.pago.usuario.nombre }}
          {{ reservaOriginal.pago.usuario.apellido }}</span
        >
      </div>
    </div>
  </div>

  <p class="repro-modal__helper-text">
    <mat-icon>info</mat-icon> Selecciona un nuevo vehículo y rango de horario.
  </p>

  <div class="repro-modal__form-grid">
    <div class="repro-modal__section">
      <h3 class="repro-modal__section-title">Datos del Vehículo</h3>
      <mat-form-field appearance="fill" class="repro-modal__field">
        <mat-icon matPrefix>car_rental</mat-icon>
        <mat-label>Vehículo</mat-label>
        <mat-select formControlName="vehiculoId">
          <mat-optgroup label="Buscar Vehiculo">
            <div class="repro-modal__search-container">
              <mat-form-field class="search-field">
                <mat-icon matPrefix>search</mat-icon>
                <input
                  matInput
                  placeholder="Placa o marca"
                  (keyup)="filtroVehiculo.set($event.target.value)"
                />
              </mat-form-field>
            </div>
          </mat-optgroup>
          @for (vehiculo of vehiculosFiltrados; track vehiculo.id) {
          <mat-option [value]="vehiculo.id">
            {{ vehiculo.placa }} — {{ vehiculo.marca }} ({{ vehiculo.modelo }})
          </mat-option>
          }
        </mat-select>
      </mat-form-field>
    </div>

    <div class="repro-modal__section">
      <h3 class="repro-modal__section-title">Nueva Programación</h3>
      <div class="repro-modal__calendar-box">
        <mat-form-field appearance="outline" class="repro-modal__field">
          <mat-label>Fecha y Hora Seleccionada</mat-label>
          <input
            matInput
            formControlName="fechaReserva"
            readonly
            placeholder="Click en el botón lateral"
          />
          <button
            mat-icon-button
            matSuffix
            (click)="openCalendarDialog()"
            [disabled]="form.get('vehiculoId')?.invalid"
            color="primary"
          >
            <mat-icon>calendar_month</mat-icon>
          </button>
        </mat-form-field>

        <mat-form-field appearance="outline" class="repro-modal__field">
          <mat-label>Minutos</mat-label>
          <input matInput type="number" formControlName="minutosReservados" readonly />
          <mat-icon matPrefix>timer</mat-icon>
        </mat-form-field>
      </div>
    </div>
  </div>

  } @else {
  <div class="repro-modal__error">
    <mat-icon>error_outline</mat-icon>
    <p>No se pudo cargar la información de la reserva.</p>
  </div>
  }
</mat-dialog-content>

<mat-dialog-actions align="end" class="repro-modal__actions">
  <button mat-button (click)="close()" class="repro-modal__btn-cancel">Cancelar</button>
  <button mat-raised-button color="primary" (click)="save()" class="repro-modal__btn-save">
    <mat-icon>save</mat-icon> Confirmar
  </button>
</mat-dialog-actions>
