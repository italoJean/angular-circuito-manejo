 <h2 mat-dialog-title class="dialog-title">
  <mat-icon class="title-icon">update</mat-icon>
  Reprogramar Reserva #{{ reservaId }}
</h2>

<mat-dialog-content class="dialog-body" [formGroup]="form">
  @if (!isLoading) {
  <div class="loading-box">Cargando datos de la reserva y horarios...</div>
  } @else if (reservaOriginal) {
  <div class="info-box-reprogramar">
    <p><strong>Actual:</strong> {{ reservaOriginal.fechaReserva | date : 'dd/MM/yyyy HH:mm' }}</p>
    <p>
      <strong>Vehículo:</strong> {{ reservaOriginal.vehiculo.placa }} ({{
        reservaOriginal.vehiculo.modelo
      }})
    </p>
    <p>
      <strong>Cliente:</strong> {{ reservaOriginal.pago.usuario.nombre }}
      {{ reservaOriginal.pago.usuario.apellido }}
    </p>
    <p class="warning-text">Selecciona un nuevo rango de horario en el calendario.</p>

    <div class="section-title">Datos del Vehiculo</div>
    <mat-form-field appearance="fill" class="full-width">
      <mat-icon matPrefix>car_rental</mat-icon>
      <mat-label>Vehículo</mat-label>

      <mat-select formControlName="vehiculoId">
        <mat-optgroup label="Buscar vehículo">
          <mat-form-field class="search-field">
            <mat-icon matPrefix>search</mat-icon>
            <input
              matInput
              placeholder="Placa o marca"
              (keyup)="filtroVehiculo.set($event.target.value)"
            />
          </mat-form-field>
        </mat-optgroup>

        @for (vehiculo of vehiculosFiltrados; track vehiculo.id) {
        <mat-option [value]="vehiculo.id">
          {{ vehiculo.placa }} — {{ vehiculo.marca }} ({{ vehiculo.modelo }})
        </mat-option>
        }
      </mat-select>

      <mat-error *ngIf="form.get('vehiculoId')?.hasError('required')">
        El vehículo es obligatorio
      </mat-error>
    </mat-form-field>

    
      <button
        mat-stroked-button
        color="primary"
        (click)="openCalendarDialog()"
        class="calendar-btn"
        [disabled]="form.get('vehiculoId')?.invalid"
      >
        <mat-icon>calendar_month</mat-icon>
        Seleccionar
      </button>

    <div class="section-title">Datos de la fecha de Reserva</div>
    <div class="fecha-group">
      <mat-form-field appearance="fill" class="full-width">
        <mat-icon matPrefix>event</mat-icon>
        <mat-label>Fecha y Hora de Reserva</mat-label>

        <input
          matInput
          formControlName="fechaReserva"
          readonly
          placeholder="Seleccione en el calendario"
        />
      </mat-form-field>

    </div>

    <mat-form-field appearance="fill" class="full-width">
      <mat-icon matPrefix>timer</mat-icon>
      <mat-label>Minutos Reservados</mat-label>

      <input matInput type="number" formControlName="minutosReservados" min="1" />
      <mat-hint>Establecido por el calendario</mat-hint>

      <mat-error *ngIf="form.get('minutosReservados')?.hasError('required')">
        Este campo es obligatorio
      </mat-error>

      <mat-error *ngIf="form.get('minutosReservados')?.hasError('min')">
        Debe ser al menos 1 minuto
      </mat-error>
    </mat-form-field>
  </div>

  } @else {
  <div class="error-box">No se pudo cargar la información de la reserva.</div>
  }
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="close()">
    <mat-icon>close</mat-icon>
    Cerrar
  </button>
  
    <button 
        mat-raised-button 
        (click)="save()" 
    >
        <mat-icon>save</mat-icon>
        Confirmar Reprogramación
    </button>
</mat-dialog-actions> 
<!-- 

<h2 mat-dialog-title class="dialog__title">
  <mat-icon class="dialog__icon">update</mat-icon>
  Reprogramar Reserva #{{ reservaId }}
</h2>

<mat-dialog-content class="dialog__content" [formGroup]="form">
  @if (isLoading) {
    <div class="loading-box">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Cargando datos de la reserva y horarios...</p>
    </div>
  } @else if (reservaOriginal) {
    
    <div class="reserva-info">
      <h3 class="reserva-info__title">Detalles Actuales</h3>
      <p class="reserva-info__item">
        <strong>Actual:</strong> {{ reservaOriginal.fechaReserva | date : 'dd/MM/yyyy HH:mm' }}
      </p>
      <p class="reserva-info__item">
        <strong>Vehículo:</strong> {{ reservaOriginal.vehiculo.placa }} ({{
          reservaOriginal.vehiculo.modelo
        }})
      </p>
      <p class="reserva-info__item">
        <strong>Cliente:</strong> {{ reservaOriginal.pago.usuario.nombre }}
        {{ reservaOriginal.pago.usuario.apellido }}
      </p>
      <p class="reserva-info__warning">
        <mat-icon>event_available</mat-icon>
        Selecciona un nuevo rango de horario en el calendario.
      </p>
    </div>

    <div class="form-section">
      <h3 class="form-section__title">Datos del Vehículo</h3>
      
      <mat-form-field appearance="outline" class="form-section__field full-width">
        <mat-icon matPrefix>car_rental</mat-icon>
        <mat-label>Vehículo</mat-label>

        <mat-select formControlName="vehiculoId">
          <mat-optgroup label="Buscar vehículo" class="search-group">
            <mat-form-field class="search-field">
              <mat-icon matPrefix>search</mat-icon>
              <input
                matInput
                placeholder="Placa o marca"
                (keyup)="filtroVehiculo.set($event.target.value)"
              />
            </mat-form-field>
          </mat-optgroup>

          @for (vehiculo of vehiculosFiltrados; track vehiculo.id) {
          <mat-option [value]="vehiculo.id">
            {{ vehiculo.placa }} — {{ vehiculo.marca }} ({{ vehiculo.modelo }})
          </mat-option>
          }
        </mat-select>

        <mat-error *ngIf="form.get('vehiculoId')?.hasError('required')">
          El vehículo es obligatorio
        </mat-error>
      </mat-form-field>

      <h3 class="form-section__title">Nueva Fecha y Hora</h3>
      <div class="date-picker-group">
        
        <mat-form-field appearance="outline" class="form-section__field date-picker-group__input">
          <mat-icon matPrefix>event</mat-icon>
          <mat-label>Fecha y Hora de Reserva</mat-label>

          <input
            matInput
            formControlName="fechaReserva"
            readonly
            placeholder="Seleccione en el calendario"
          />
          <mat-hint *ngIf="form.get('fechaReserva')?.value">
            Seleccionado: {{ form.get('fechaReserva')?.value | date: 'medium' }}
          </mat-hint>
        </mat-form-field>
        
        <button
          mat-flat-button
          color="primary"
          (click)="openCalendarDialog()"
          class="date-picker-group__btn"
          [disabled]="form.get('vehiculoId')?.invalid || isLoading"
        >
          <mat-icon>calendar_month</mat-icon>
          Seleccionar Horario
        </button>
      </div>

      <mat-form-field appearance="outline" class="form-section__field full-width">
        <mat-icon matPrefix>timer</mat-icon>
        <mat-label>Minutos Reservados</mat-label>

        <input matInput type="number" formControlName="minutosReservados" min="1" readonly />
        <mat-hint>Duración establecida automáticamente por el calendario.</mat-hint>

        <mat-error *ngIf="form.get('minutosReservados')?.hasError('required')">
          Este campo es obligatorio
        </mat-error>

        <mat-error *ngIf="form.get('minutosReservados')?.hasError('min')">
          Debe ser al menos 1 minuto
        </mat-error>
      </mat-form-field>
    </div>

  } @else {
    <div class="error-box">
        <mat-icon>error</mat-icon>
        No se pudo cargar la información de la reserva.
    </div>
  }
</mat-dialog-content>

<mat-dialog-actions align="end" class="dialog__actions">
  <button mat-button (click)="close()">
    <mat-icon>close</mat-icon>
    Cerrar
  </button>
  
  <button 
    mat-raised-button 
    color="primary"
    (click)="save()" 
    [disabled]="form.invalid || isLoading"
  >
    <mat-icon>save</mat-icon>
    Confirmar Reprogramación
  </button>
</mat-dialog-actions> -->