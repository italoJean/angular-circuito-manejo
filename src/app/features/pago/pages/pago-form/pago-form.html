<h2 mat-dialog-title class="modal__header">
  <mat-icon class="modal__header-icon">payments</mat-icon>
  {{ isEditing ? 'Editar Pago' : 'Nuevo Pago' }}
</h2>

<mat-dialog-content [formGroup]="form" class="modal__body form">
  
  <div class="form__section-title">Datos del Cliente</div>

  <mat-form-field appearance="outline" class="form__field form__field--select-search">
    <mat-label>Cliente</mat-label>
    <mat-icon matPrefix class="form__icon">person</mat-icon>
    <input matInput (input)="onFilterUsuario($event)" placeholder="Nombre o DNI...">
    <mat-select formControlName="usuarioId">
      @for (usuario of usuariosFiltrados(); track usuario.id) {
      <mat-option [value]="usuario.id">
        {{ usuario.nombre }} {{ usuario.apellido }} ({{ usuario.numeroDocumento }})
      </mat-option>
      }
    </mat-select>
  </mat-form-field>

  <div class="form__section-title">Datos del Paquete</div>

  <mat-form-field appearance="outline" class="form__field form__field--select-search">
    <mat-label>Paquete</mat-label>
    <mat-icon matPrefix class="form__icon">shopping_bag</mat-icon>
    <input matInput (input)="onFilterPaquete($event)" placeholder="Nombre del paquete...">
    <mat-select formControlName="paqueteId">
      @for (paquete of paquetesFiltrados(); track paquete.id) {
      <mat-option [value]="paquete.id">
        {{ paquete.nombre }} - {{ paquete.precioTotal | currency : 'PEN' }}
      </mat-option>
      }
    </mat-select>
  </mat-form-field>

  <div class="form__section-title">Configuración de Pago</div>

  <mat-form-field appearance="outline" class="form__field form__field--select">
    <mat-label>Metodo de Pago</mat-label>
    <mat-icon matPrefix class="form__icon">credit_card</mat-icon>
    <mat-select formControlName="metodoPago">
      @for (metodo of metodoPagos; track metodo) {
      <mat-option [value]="metodo">{{ metodo }}</mat-option>
      }
    </mat-select>
  </mat-form-field>

  <mat-slide-toggle formControlName="pagarEnCuotas" class="form__toggle-cuotas" color="primary">
    ¿Pagar en cuotas?
  </mat-slide-toggle>

  @if (form.get('pagarEnCuotas')?.value) {
  <div class="form__cuotas-box form__cuotas-box--fade">
    <mat-form-field appearance="outline" class="form__field">
      <mat-label>Número de cuotas</mat-label>
      <mat-icon matPrefix class="form__icon">splitscreen</mat-icon>
      <input matInput type="number" inputmode="numeric" formControlName="cuotas" min="2" max="12" />
      <mat-hint>Mínimo 2, Máximo 12</mat-hint>
    </mat-form-field>

    <mat-form-field appearance="outline" class="form__field">
      <mat-label>Monto inicial (S/)</mat-label>
      <mat-icon matPrefix class="form__icon">attach_money</mat-icon>
      <input matInput type="number" inputmode="numeric" formControlName="montoPrimerPago" />
    </mat-form-field>
  </div>
  }
</mat-dialog-content>

<mat-dialog-actions align="end" class="modal__actions">
  <button mat-button (click)="close()" [disabled]="loading">Cancelar</button>
  <button mat-flat-button color="primary" (click)="save()" [disabled]="form.invalid || loading">
    <mat-icon>save</mat-icon>
    @if (loading) {
    <mat-spinner diameter="18" style="margin-right: 8px; display: inline-block"></mat-spinner>
    Enviando... } @else {
      
      Confirmar Operación
    }
  </button>
</mat-dialog-actions>